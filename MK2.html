<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tabel Periodik Interaktif ‚Äì Flipped Periodic Table</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --gap: 8px;
        --card-w: min(
          max(calc((100vw - 48px - (17 * var(--gap))) / 14), 80px),
          140px
        );
        --card-h: calc(var(--card-w) * 1.3);
        --navy: #0e2546;

        /* üé® warna kuat dan mencolok per golongan */
        --alkali: #ffb347; /* oranye terang */
        --alkaline: #ff8fa3; /* merah muda cerah */
        --transition: #66b3ff; /* biru cerah */
        --posttransition: #c084fc; /* ungu cerah */
        --metalloid: #7fe57f; /* hijau lembut jelas */
        --nonmetal: #ffd966; /* kuning terang */
        --halogen: #4ed99c; /* hijau toska */
        --noble: #7fdbff; /* biru langit */
        --other: #e5e5e5; /* abu terang */
      }
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        background: linear-gradient(180deg, #f3f6ff, #ffffff);
        color: var(--navy);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 16px;
      }
      h1 {
        margin: 0;
        font-size: 22px;
        font-weight: 700;
      }
      .subtitle {
        color: #2f3e9e;
        margin: 8px 0 16px;
        font-size: 14px;
        text-align: center;
      }
      .table-wrap {
        width: 100%;
        max-width: 1280px;
        overflow: auto;
        padding: 4px;
      }
      .ptable {
        display: grid;
        grid-template-columns: repeat(18, 1fr);
        grid-auto-rows: auto; /* otomatis menyesuaikan tinggi kartu + input */
        gap: var(--gap);
        justify-items: center;
        align-items: start;
      }
      .element {
        width: 100%;
        max-width: var(--card-w);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
      }

      .inner {
        width: 100%;
        height: var(--card-h);
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.55s cubic-bezier(0.2, 0.8, 0.2, 1);
        border-radius: 12px;
      }

      .input-wrap {
        width: 100%;
        display: flex;
        justify-content: center;
      }

      input {
        width: 90%;
        padding: 4px;
        font-size: 12px;
        box-sizing: border-box;
      }

      .element.flipped .inner {
        transform: rotateY(180deg);
      }
      .face {
        position: absolute;
        inset: 0;
        border-radius: 8px;
        backface-visibility: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      }
      /* SISI DEPAN: Detail lengkap unsur */
      .front {
        background: #fff;
        color: var(--navy);
        border: 2px solid #bbb;
        text-align: center;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 8px;
      }

      .atomic-number {
        font-size: calc(var(--card-h) * 0.16);
        font-weight: 600;
        color: #3b3b3b;
        text-align: left;
      }

      .symbol {
        font-size: calc(var(--card-h) * 0.38);
        font-weight: 700;
        line-height: 1;
      }

      .mass {
        font-size: calc(var(--card-h) * 0.14);
        font-weight: 500;
        color: #333;
      }

      /* SISI BELAKANG: Hanya nomor atom dengan warna */
      .back {
        color: #fff;
        font-weight: 600;
        font-size: calc(var(--card-h) * 0.18);
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);
        transform: rotateY(180deg);
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 10px;
        overflow-wrap: break-word; /* biar teks panjang tetap masuk */
        word-break: break-word;
        line-height: 1.2;
        border-radius: 12px;
        column-count: 3; /* jumlah kolom */
        column-gap: 12px; /* jarak antar kolom */
        column-rule: 1px solid rgba(255, 255, 255, 0.3);
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .submitBtn {
        padding: 4px 8px;
        background: linear-gradient(135deg, #00d4ff, #0099ff);
        border: none;
        border-radius: 4px;
        color: white;
        cursor: pointer;
        font-size: 14px;
        margin-left: 2px;
        transition: all 0.3s ease;
      }

      .submitBtn:hover {
        background: linear-gradient(135deg, #0099ff, #0077cc);
        transform: scale(1.05);
      }

      .submitBtn:disabled {
        background: #ccc;
        cursor: not-allowed;
        opacity: 0.6;
      }

      input {
        transition: all 0.3s ease;
      }
      /* Header Navigation Buttons */
      .header-nav {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin: 15px 0;
        flex-wrap: wrap;
      }

      .nav-button {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .btn-back {
        background: linear-gradient(135deg, #6c757d, #495057);
        color: white;
      }

      .btn-back:hover {
        background: linear-gradient(135deg, #495057, #343a40);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .btn-leaderboard {
        background: linear-gradient(135deg, #ffc107, #ff9800);
        color: white;
      }

      .btn-leaderboard:hover {
        background: linear-gradient(135deg, #ff9800, #f57c00);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
      }

      /* Leaderboard Modal */
      .leaderboard-modal {
        display: none;
        position: fixed;
        z-index: 3000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        animation: fadeIn 0.3s ease;
      }

      .leaderboard-content {
        position: relative;
        background: white;
        margin: 3% auto;
        padding: 0;
        width: 90%;
        max-width: 600px;
        border-radius: 20px;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
        animation: slideDown 0.4s ease;
      }

      .leaderboard-header {
        background: linear-gradient(135deg, #ffc107, #ff9800);
        color: white;
        padding: 25px;
        text-align: center;
        border-radius: 20px 20px 0 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .leaderboard-header h2 {
        margin: 0;
        font-size: 1.8em;
      }

      .leaderboard-body {
        padding: 30px;
        max-height: 500px;
        overflow-y: auto;
      }

      .leaderboard-table {
        width: 100%;
        border-collapse: collapse;
      }

      .leaderboard-table thead {
        background: #f8f9fa;
        position: sticky;
        top: 0;
      }

      .leaderboard-table th {
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: #495057;
        border-bottom: 2px solid #dee2e6;
      }

      .leaderboard-table td {
        padding: 12px;
        border-bottom: 1px solid #e9ecef;
      }

      .leaderboard-table tr:hover {
        background: #f8f9fa;
      }

      .rank {
        font-weight: 700;
        font-size: 1.2em;
        text-align: center;
        width: 50px;
      }

      .rank-1 {
        color: #ffd700;
      }
      .rank-2 {
        color: #c0c0c0;
      }
      .rank-3 {
        color: #cd7f32;
      }

      .player-name {
        font-weight: 600;
        color: var(--navy);
      }

      .score {
        font-weight: 700;
        color: #28a745;
        text-align: center;
      }

      .badge {
        display: inline-block;
        padding: 3px 8px;
        background: #ffc107;
        color: white;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: 600;
      }

      .close-leaderboard {
        position: absolute;
        right: 15px;
        top: 15px;
        font-size: 28px;
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: all 0.3s;
        background: rgba(255, 255, 255, 0.2);
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close-leaderboard:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
      }

      .your-score {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 20px;
        text-align: center;
      }

      .your-score h3 {
        margin: 0 0 10px 0;
        font-size: 1.2em;
      }

      .your-score .score-value {
        font-size: 2.5em;
        font-weight: 700;
      }

      .progress-info {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 12px;
        margin-top: 20px;
        border-left: 4px solid #2196f3;
      }

      .progress-info p {
        margin: 5px 0;
        color: #1565c0;
        font-size: 0.95em;
      }

      @media (max-width: 768px) {
        .header-nav {
          flex-direction: column;
          align-items: stretch;
        }

        .nav-button {
          justify-content: center;
        }

        .leaderboard-content {
          width: 95%;
          margin: 10% auto;
        }

        .leaderboard-table th,
        .leaderboard-table td {
          padding: 8px;
          font-size: 0.9em;
        }
      }
    </style>
  </head>
  <body>
    <audio id="clickSound" src="sound.mp3"></audio>
    <audio id="correctSound" src="correct.mp3"></audio>
    <audio id="wrongSound" src="wrong.mp3"></audio>
    <audio id="backgroundMusic" src="backsound.mp3" loop></audio>

    <h1>Tabel Periodik Interaktif ‚Äì Flipped Periodic Table</h1>
    <p class="subtitle">Ayo Belajar Konfigurasi Elektron</p>

    <!-- User nickname centered, below subtitle and above header buttons -->
    <div id="userNameRow" style="text-align:center; margin:8px 0 12px 0;">
      <span id="userDisplay" style="font-weight:600; font-size:20px; display:inline-block;">
        <!-- filled by Firebase onAuthStateChanged -->
      </span>
    </div>

    <!-- Sound controls (effects + music) in a single row -->
    <div id="soundControls" style="display:flex; justify-content:center; gap:8px; margin-bottom:8px;"></div>

    <!-- Score shown under the sound controls, centered -->
    <div id="scoreRow" style="text-align:center; margin-bottom:12px;">
      <span id="userScore" style="font-weight:800; color:#28a745; font-size:28px; display:inline-block; line-height:1;">Skor: 0</span>
    </div>

    <div class="header-nav">
      <a href="index.html" class="nav-button btn-back">‚¨ÖÔ∏è Kembali</a>
      <button class="nav-button" id="resetProgressBtn" style="background:linear-gradient(135deg,#ff6b6b,#ff4757);color:white;" onclick="resetProgress()">üîÑ Reset Skor & Kartu</button>
      <a href="#" class="nav-button btn-leaderboard" onclick="showLeaderboard()"
        >üèÜ Lihat Peringkat</a
      >
    </div>

    <!-- üéØ Modal Leaderboard -->
<div
  id="leaderboardModal"
  style="
    display:none;
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.5);
    backdrop-filter:blur(4px);
    z-index:1000;
    justify-content:center;
    align-items:center;
  "
>
  <div
    style="
      background:white;
      padding:20px;
      border-radius:12px;
      width:90%;
      max-width:600px;
      max-height:80%;
      overflow:auto;
      box-shadow:0 4px 12px rgba(0,0,0,0.3);
      position:relative;
    "
  >
    <button
      onclick="closeLeaderboard()"
      style="
        position:absolute;
        top:10px;
        right:10px;
        background:#ff4444;
        color:white;
        border:none;
        padding:6px 10px;
        border-radius:6px;
        cursor:pointer;
      "
    >
      ‚úñ
    </button>
    <h2 style="text-align:center;margin-bottom:10px;">üèÜ Leaderboard</h2>

    <!-- üîò Tombol Filter -->
    <div style="text-align:center;margin-bottom:10px;">
      <button
        onclick="showLeaderboard('global')"
        style="margin-right:10px;padding:6px 10px;border-radius:6px;cursor:pointer;"
      >
        üåç Global
      </button>
      <button
        onclick="showLeaderboard('kelas')"
        style="padding:6px 10px;border-radius:6px;cursor:pointer;"
      >
        üè´ Kelas Saya
      </button>
    </div>

    <!-- üìä Tabel -->
    <table
      style="
        width:100%;
        border-collapse:collapse;
        text-align:center;
        font-family:Poppins,sans-serif;
      "
    >
      <thead style="background:#f0f0f0;">
        <tr>
          <th style="padding:8px;">Peringkat</th>
          <th style="padding:8px;">Nama</th>
          <th style="padding:8px;">Kelas</th>
          <th style="padding:8px;">Skor</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>

          <div class="progress-info">
            <p>
              <strong>üí° Tips:</strong> Jawab semua unsur dengan benar untuk
              naik peringkat!
            </p>
            <p>
              <strong>üìä Total Unsur:</strong>
              <span id="totalElements">103</span>
            </p>
            <p>
              <strong>‚úÖ Dijawab Benar:</strong>
              <span id="answeredCorrect">0</span>
            </p>
          </div>
        </div>
      </div>

          <!-- üè∑Ô∏è Modal Pilih Kelas (untuk user yang belum punya kelas) -->
          <div id="chooseClassModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
            <div style="background:white; padding:20px; border-radius:12px; width:90%; max-width:420px; text-align:center;">
              <h3>Pilih Kelas Anda</h3>
              <p style="margin-top:6px; margin-bottom:12px; color:#333;">Agar leaderboard menampilkan kelas Anda, pilih kelas yang sesuai.</p>
              <select id="kelasSelect" style="width:100%; padding:8px; font-size:16px; margin-bottom:12px;">
                 <option value="X-1">X-1</option>
                  <option value="X-2">X-2</option>
                  <option value="X-3">X-3</option>
                  <option value="X-4">X-4</option>
                  <option value="X-5">X-5</option>
                  <option value="X-6">X-6</option>
                  <option value="X-7">X-7</option>
                  <option value="X-8">X-8</option>
                  <option value="X-9">X-9</option>
                  <option value="X-10">X-10</option>
              </select>
              <div style="display:flex; gap:8px; justify-content:center;">
                <button id="saveKelasBtn" style="padding:8px 12px; background:#28a745; color:white; border:none; border-radius:8px; cursor:pointer;">Simpan</button>
              </div>
            </div>
          </div>
              <!-- Reset Confirmation Modal -->
              <div id="resetConfirmModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:2500; justify-content:center; align-items:center;">
                <div style="background:white; padding:18px; border-radius:12px; width:90%; max-width:420px; text-align:center;">
                  <h3 style="margin-top:0">Konfirmasi Reset</h3>
                  <p id="resetConfirmText" style="color:#333; margin:10px 0 16px;">Anda yakin ingin mereset skor dan mengembalikan semua kartu ke posisi semula? (Tidak dapat dibatalkan)</p>
                  <div style="display:flex; gap:10px; justify-content:center;">
                    <button id="cancelResetBtn" style="padding:8px 12px; background:#6c757d; color:white; border:none; border-radius:8px; cursor:pointer;">Batal</button>
                    <button id="confirmResetBtn" style="padding:8px 12px; background:#ff4757; color:white; border:none; border-radius:8px; cursor:pointer;">Ya, Reset</button>
                  </div>
                </div>
              </div>

              <!-- Toast notification -->
              <div id="toast" style="display:none; position:fixed; right:20px; bottom:20px; background:rgba(0,0,0,0.85); color:white; padding:10px 14px; border-radius:8px; z-index:4000; font-weight:600;"></div>
    </div>

    <!-- Answer Input Modal (besar, dengan riwayat jawaban per kartu) -->
    <div id="answerInputModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:3500; justify-content:center; align-items:center;">
      <div style="background:white; padding:16px; border-radius:12px; width:92%; max-width:520px;">
        <h3 style="margin:0 0 8px 0">Masukkan Jawaban</h3>
        <p id="answerModalHint" style="margin:0 0 12px 0; color:#444; font-size:0.95em">Ketik konfigurasi elektron lengkap di kotak di bawah. Riwayat input untuk unsur ini disimpan di sisi client.</p>
        <textarea id="answerModalInput" rows="3" style="width:100%; padding:8px; font-size:14px; box-sizing:border-box; resize:vertical;"></textarea>
        <div style="display:flex; gap:8px; margin-top:10px; align-items:center; justify-content:flex-end;">
          <button id="answerModalCancel" style="padding:8px 12px; background:#6c757d; color:white; border:none; border-radius:8px; cursor:pointer;">Batal</button>
          <button id="answerModalSubmit" style="padding:8px 12px; background:linear-gradient(135deg,#00d4ff,#0099ff); color:white; border:none; border-radius:8px; cursor:pointer;">Kirim Jawaban</button>
        </div>
        <hr style="margin:12px 0; border:none; border-top:1px solid #eee" />
        <div>
          <strong>Riwayat Input</strong>
          <div id="answerHistory" style="margin-top:8px; max-height:160px; overflow:auto; background:#fafafa; padding:8px; border-radius:8px; border:1px solid #eee; font-size:13px;"></div>
        </div>
      </div>
    </div>

    <div class="table-wrap">
      <div id="ptable" class="ptable"></div>
    </div>

    <script>
      const elements = [
        //periode 1//
        { z: 1, s: "H", mass: "1.008", r: 1, c: 1, spdf: "1s¬π" },
        { z: 2, s: "He", mass: "4.0026", r: 1, c: 18, spdf: "1s¬≤" },
        //periode 2//
        { z: 3, s: "Li", mass: "6.94", r: 2, c: 1, spdf: "1s¬≤ 2s¬π" },
        { z: 4, s: "Be", mass: "9.0122", r: 2, c: 2, spdf: "1s¬≤ 2s¬≤" },
        { z: 5, s: "B", mass: "10.81", r: 2, c: 13, spdf: "1s¬≤ 2s¬≤ 2p¬π" },
        { z: 6, s: "C", mass: "12.011", r: 2, c: 14, spdf: "1s¬≤ 2s¬≤ 2p¬≤" },
        { z: 7, s: "N", mass: "14.007", r: 2, c: 15, spdf: "1s¬≤ 2s¬≤ 2p¬≥" },
        { z: 8, s: "O", mass: "15.999", r: 2, c: 16, spdf: "1s¬≤ 2s¬≤ 2p‚Å¥" },
        { z: 9, s: "F", mass: "18.998", r: 2, c: 17, spdf: "1s¬≤ 2s¬≤ 2p‚Åµ" },
        { z: 10, s: "Ne", mass: "20.180", r: 2, c: 18, spdf: "1s¬≤ 2s¬≤ 2p‚Å∂" },
        //periode 3//
        { z: 11, s: "Na", mass: "22.990", r: 3, c: 1, spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬π" },
        { z: 12, s: "Mg", mass: "24.305", r: 3, c: 2, spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤" },
        {
          z: 13,
          s: "Al",
          mass: "26.982",
          r: 3,
          c: 13,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p¬π",
        },
        {
          z: 14,
          s: "Si",
          mass: "28.085",
          r: 3,
          c: 14,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p¬≤",
        },
        {
          z: 15,
          s: "P",
          mass: "30.974",
          r: 3,
          c: 15,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p¬≥",
        },
        {
          z: 16,
          s: "S",
          mass: "32.06",
          r: 3,
          c: 16,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å¥",
        },
        {
          z: 17,
          s: "Cl",
          mass: "35.45",
          r: 3,
          c: 17,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Åµ",
        },
        {
          z: 18,
          s: "Ar",
          mass: "39.948",
          r: 3,
          c: 18,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂",
        },
        //periode 4//
        {
          z: 19,
          s: "K",
          mass: "39.098",
          r: 4,
          c: 1,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬π",
        },
        {
          z: 20,
          s: "Ca",
          mass: "40.078",
          r: 4,
          c: 2,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤",
        },

        {
          z: 21,
          s: "Sc",
          mass: "44.956",
          r: 4,
          c: 3,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π",
        },
        {
          z: 22,
          s: "Ti",
          mass: "47.867",
          r: 4,
          c: 4,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬≤",
        },
        {
          z: 23,
          s: "V",
          mass: "50.942",
          r: 4,
          c: 5,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬≥",
        },
        {
          z: 24,
          s: "Cr",
          mass: "51.996",
          r: 4,
          c: 6,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬π 3d‚Åµ",
        },
        {
          z: 25,
          s: "Mn",
          mass: "54.938",
          r: 4,
          c: 7,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d‚Åµ",
        },
        {
          z: 26,
          s: "Fe",
          mass: "55.845",
          r: 4,
          c: 8,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d‚Å∂",
        },
        {
          z: 27,
          s: "Co",
          mass: "58.933",
          r: 4,
          c: 9,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d‚Å∑",
        },
        {
          z: 28,
          s: "Ni",
          mass: "58.693",
          r: 4,
          c: 10,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d‚Å∏",
        },
        {
          z: 29,
          s: "Cu",
          mass: "63.546",
          r: 4,
          c: 11,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬π 3d¬π‚Å∞",
        },
        {
          z: 30,
          s: "Zn",
          mass: "65.38",
          r: 4,
          c: 12,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞",
        },

        {
          z: 31,
          s: "Ga",
          mass: "69.723",
          r: 4,
          c: 13,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p¬π",
        },
        {
          z: 32,
          s: "Ge",
          mass: "72.63",
          r: 4,
          c: 14,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p¬≤",
        },
        {
          z: 33,
          s: "As",
          mass: "74.922",
          r: 4,
          c: 15,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p¬≥",
        },
        {
          z: 34,
          s: "Se",
          mass: "78.971",
          r: 4,
          c: 16,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å¥",
        },
        {
          z: 35,
          s: "Br",
          mass: "79.904",
          r: 4,
          c: 17,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Åµ",
        },
        {
          z: 36,
          s: "Kr",
          mass: "83.798",
          r: 4,
          c: 18,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂",
        },
        //periode 5//
        {
          z: 37,
          s: "Rb",
          mass: "85.468",
          r: 5,
          c: 1,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬π",
        },
        {
          z: 38,
          s: "Sr",
          mass: "87.62",
          r: 5,
          c: 2,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤",
        },
        {
          z: 39,
          s: "Y",
          mass: "88.906",
          r: 5,
          c: 3,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π",
        },
        {
          z: 40,
          s: "Zr",
          mass: "91.224",
          r: 5,
          c: 4,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬≤",
        },
        {
          z: 41,
          s: "Nb",
          mass: "92.906",
          r: 5,
          c: 5,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬π 4d‚Å¥",
        },
        {
          z: 42,
          s: "Mo",
          mass: "95.95",
          r: 5,
          c: 6,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬π 4d‚Åµ",
        },
        {
          z: 43,
          s: "Tc",
          mass: "98",
          r: 5,
          c: 7,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d‚Åµ",
        },
        {
          z: 44,
          s: "Ru",
          mass: "101.07",
          r: 5,
          c: 8,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬π 4d‚Å∑",
        },
        {
          z: 45,
          s: "Rh",
          mass: "102.91",
          r: 5,
          c: 9,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬π 4d‚Å∏",
        },
        {
          z: 46,
          s: "Pd",
          mass: "106.42",
          r: 5,
          c: 10,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 4d¬π‚Å∞",
        },
        {
          z: 47,
          s: "Ag",
          mass: "107.87",
          r: 5,
          c: 11,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬π 4d¬π‚Å∞",
        },
        {
          z: 48,
          s: "Cd",
          mass: "112.41",
          r: 5,
          c: 12,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞",
        },

        {
          z: 49,
          s: "In",
          mass: "114.82",
          r: 5,
          c: 13,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p¬π",
        },
        {
          z: 50,
          s: "Sn",
          mass: "118.71",
          r: 5,
          c: 14,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p¬≤",
        },
        {
          z: 51,
          s: "Sb",
          mass: "121.76",
          r: 5,
          c: 15,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p¬≥",
        },
        {
          z: 52,
          s: "Te",
          mass: "127.60",
          r: 5,
          c: 16,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å¥",
        },
        {
          z: 53,
          s: "I",
          mass: "126.90",
          r: 5,
          c: 17,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Åµ",
        },
        {
          z: 54,
          s: "Xe",
          mass: "131.29",
          r: 5,
          c: 18,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂",
        },

        //periode 6//
        {
          z: 55,
          s: "Cs",
          mass: "132.91",
          r: 6,
          c: 1,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬π",
        },
        {
          z: 56,
          s: "Ba",
          mass: "137.33",
          r: 6,
          c: 2,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤",
        },
        {
          z: 57,
          s: "La",
          mass: "138.91",
          r: 6,
          c: 3,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 5d¬π",
        },
        {
          z: 72,
          s: "Hf",
          mass: "178.49",
          r: 6,
          c: 4,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 4f¬π‚Å¥ 5d¬≤ 6s¬≤",
        },
        {
          z: 73,
          s: "Ta",
          mass: "180.95",
          r: 6,
          c: 5,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬≥",
        },
        {
          z: 74,
          s: "W",
          mass: "183.84",
          r: 6,
          c: 6,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬π 4f¬π‚Å¥ 5d‚Åµ",
        },
        {
          z: 75,
          s: "Re",
          mass: "186.21",
          r: 6,
          c: 7,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d‚Åµ",
        },
        {
          z: 76,
          s: "Os",
          mass: "190.23",
          r: 6,
          c: 8,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d‚Å∂",
        },
        {
          z: 77,
          s: "Ir",
          mass: "192.22",
          r: 6,
          c: 9,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d‚Å∑",
        },
        {
          z: 78,
          s: "Pt",
          mass: "195.08",
          r: 6,
          c: 10,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬π 4f¬π‚Å¥ 5d‚Åπ",
        },
        {
          z: 79,
          s: "Au",
          mass: "196.97",
          r: 6,
          c: 11,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬π 4f¬π‚Å¥ 5d¬π‚Å∞",
        },
        {
          z: 80,
          s: "Hg",
          mass: "200.59",
          r: 6,
          c: 12,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞",
        },
        {
          z: 81,
          s: "Tl",
          mass: "204.38",
          r: 6,
          c: 13,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p¬π",
        },
        {
          z: 82,
          s: "Pb",
          mass: "207.2",
          r: 6,
          c: 14,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p¬≤",
        },
        {
          z: 83,
          s: "Bi",
          mass: "208.98",
          r: 6,
          c: 15,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p¬≥",
        },
        {
          z: 84,
          s: "Po",
          mass: "209",
          r: 6,
          c: 16,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å¥",
        },
        {
          z: 85,
          s: "At",
          mass: "210",
          r: 6,
          c: 17,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Åµ",
        },
        {
          z: 86,
          s: "Rn",
          mass: "222",
          r: 6,
          c: 18,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂",
        },
        {
          z: 87,
          s: "Fr",
          mass: "(223)",
          r: 7,
          c: 1,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬π",
        },
        {
          z: 88,
          s: "Ra",
          mass: "(226)",
          r: 7,
          c: 2,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤",
        },

        {
          z: 89,
          s: "Ac",
          mass: "(227)",
          r: 7,
          c: 3,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 6d¬π",
        },
        {
          z: 90,
          s: "Th",
          mass: "232.04",
          r: 7,
          c: 4,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 6d¬≤",
        },
        {
          z: 91,
          s: "Pa",
          mass: "231.04",
          r: 7,
          c: 5,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 5f¬≤ 7s¬≤ 6d¬π",
        },
        {
          z: 92,
          s: "U",
          mass: "238.03",
          r: 7,
          c: 6,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 5f¬≥ 7s¬≤ 6d¬π",
        },
        {
          z: 93,
          s: "Np",
          mass: "(237)",
          r: 7,
          c: 7,
          spdf: " 1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 5f‚Å¥ 7s¬≤ 6d¬π",
        },
        {
          z: 94,
          s: "Pu",
          mass: "(244)",
          r: 7,
          c: 8,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f‚Å∂",
        },
        {
          z: 95,
          s: "Am",
          mass: "(243)",
          r: 7,
          c: 9,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f‚Å∑",
        },
        {
          z: 96,
          s: "Cm",
          mass: "(247)",
          r: 7,
          c: 10,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f‚Å∑ 6d¬π",
        },
        {
          z: 97,
          s: "Bk",
          mass: "(247)",
          r: 7,
          c: 11,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f‚Åπ",
        },
        {
          z: 98,
          s: "Cf",
          mass: "(251)",
          r: 7,
          c: 12,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å∞",
        },
        {
          z: 99,
          s: "Es",
          mass: "(252)",
          r: 7,
          c: 13,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π¬π",
        },
        {
          z: 100,
          s: "Fm",
          mass: "(257)",
          r: 7,
          c: 14,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π¬≤",
        },
        {
          z: 101,
          s: "Md",
          mass: "(258)",
          r: 7,
          c: 15,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π¬≥",
        },
        {
          z: 102,
          s: "No",
          mass: "(259)",
          r: 7,
          c: 16,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥",
        },
        {
          z: 103,
          s: "Lr",
          mass: "(262)",
          r: 7,
          c: 17,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬π",
        },

        {
          z: 104,
          s: "Rf",
          mass: "(267)",
          r: 7,
          c: 4,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬≤",
        },
        {
          z: 105,
          s: "Db",
          mass: "(268)",
          r: 7,
          c: 5,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬≥",
        },
        {
          z: 106,
          s: "Sg",
          mass: "(271)",
          r: 7,
          c: 6,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬π 5f¬π‚Å¥ 6d‚Åµ",
        },
        {
          z: 107,
          s: "Bh",
          mass: "(270)",
          r: 7,
          c: 7,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d‚Åµ",
        },
        {
          z: 108,
          s: "Hs",
          mass: "(277)",
          r: 7,
          c: 8,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d‚Å∂",
        },
        {
          z: 109,
          s: "Mt",
          mass: "(278)",
          r: 7,
          c: 9,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d‚Å∑",
        },
        {
          z: 110,
          s: "Ds",
          mass: "(281)",
          r: 7,
          c: 10,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d‚Å∏",
        },
        {
          z: 111,
          s: "Rg",
          mass: "(282)",
          r: 7,
          c: 11,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d‚Åπ",
        },
        {
          z: 112,
          s: "Cn",
          mass: "(285)",
          r: 7,
          c: 12,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬π‚Å∞",
        },
        {
          z: 113,
          s: "Nh",
          mass: "(286)",
          r: 7,
          c: 13,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬π‚Å∞ 7p¬π",
        },
        {
          z: 114,
          s: "Fl",
          mass: "(289)",
          r: 7,
          c: 14,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬π‚Å∞ 7p¬≤",
        },
        {
          z: 115,
          s: "Mc",
          mass: "(290)",
          r: 7,
          c: 15,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬π‚Å∞ 7p¬≥",
        },
        {
          z: 116,
          s: "Lv",
          mass: "(293)",
          r: 7,
          c: 16,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬π‚Å∞ 7p‚Å¥",
        },
        {
          z: 117,
          s: "Ts",
          mass: "(294)",
          r: 7,
          c: 17,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬π‚Å∞ 7p‚Åµ",
        },
        {
          z: 118,
          s: "Og",
          mass: "(294)",
          r: 7,
          c: 18,
          spdf: "1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂ 4s¬≤ 3d¬π‚Å∞ 4p‚Å∂ 5s¬≤ 4d¬π‚Å∞ 5p‚Å∂ 6s¬≤ 4f¬π‚Å¥ 5d¬π‚Å∞ 6p‚Å∂ 7s¬≤ 5f¬π‚Å¥ 6d¬π‚Å∞ 7p‚Å∂",
        },
      ];

      // Fungsi untuk mendapatkan warna berdasarkan golongan

      function getColor(z) {
        if ([3, 11, 19, 37, 55, 87].includes(z)) return "var(--alkali)";
        if ([4, 12, 20, 38, 56, 88].includes(z)) return "var(--alkaline)";
        if ([9, 17, 35, 53, 85, 117].includes(z)) return "var(--halogen)";
        if ([2, 10, 18, 36, 54, 86, 118].includes(z)) return "var(--noble)";
        if ([5, 14, 32, 33, 51, 52, 84].includes(z)) return "var(--metalloid)";
        if ([1, 6, 7, 8, 15, 16, 34].includes(z)) return "var(--nonmetal)";
        if (z >= 21 && z <= 30) return "var(--transition)";
        if (z >= 39 && z <= 48) return "var(--transition)";
        if ((z >= 57 && z <= 71) || (z >= 89 && z <= 103))
          return "var(--transition)";
        if (z >= 72 && z <= 80) return "var(--transition)";
        if (z >= 104 && z <= 112) return "var(--transition)";
        if ([13, 31, 49, 50, 81, 82, 83, 113, 114, 115, 116].includes(z))
          return "var(--posttransition)";
        return "var(--other)";
      }

      // Bangun tabel
      const grid = document.getElementById("ptable");
      const clickSound = document.getElementById("clickSound");
      const correctSound = document.getElementById("correctSound");
      const wrongSound = document.getElementById("wrongSound");
      const typingSound = document.getElementById("typingSound");
      const backgroundMusic = document.getElementById("backgroundMusic"); // üîä backsound

      let soundEnabled = true; // efek suara aktif
      let musicEnabled = true; // backsound aktif

      // Tombol efek suara
      // Tombol efek suara dan musik ‚Äî akan dimasukkan ke container #soundControls
      const toggleSoundBtn = document.createElement("button");
      toggleSoundBtn.id = "toggleSound";
      toggleSoundBtn.className = 'nav-button';
      toggleSoundBtn.style = "padding:6px 12px;";
      toggleSoundBtn.textContent = "üéöÔ∏è Efek Suara";

      // Tombol backsound
      const toggleMusicBtn = document.createElement("button");
      toggleMusicBtn.id = "toggleMusic";
      toggleMusicBtn.className = 'nav-button';
      toggleMusicBtn.style = "padding:6px 12px;";
      toggleMusicBtn.textContent = "üéµ Musik";

      // append to the sound controls row if present, otherwise fallback to body near table
      const soundRow = document.getElementById('soundControls');
      if (soundRow) {
        soundRow.appendChild(toggleSoundBtn);
        soundRow.appendChild(toggleMusicBtn);
      } else {
        document.body.insertBefore(toggleSoundBtn, document.querySelector('.table-wrap'));
        document.body.insertBefore(toggleMusicBtn, document.querySelector('.table-wrap'));
      }

      // Jalankan backsound setelah klik pertama (autoplay-safe)
      window.addEventListener(
        "click",
        () => {
          if (musicEnabled && backgroundMusic.paused) {
            backgroundMusic.volume = 0.3;
            backgroundMusic.play().catch(() => {});
          }
        },
        { once: true }
      );

      // üîà Toggle Efek Suara
      toggleSoundBtn.onclick = () => {
        soundEnabled = !soundEnabled;
        toggleSoundBtn.textContent = soundEnabled
          ? "üéöÔ∏è Matikan Efek Suara"
          : "üéöÔ∏è Nyalakan Efek Suara";
      };

      // üîä Toggle Backsound
      toggleMusicBtn.onclick = () => {
        musicEnabled = !musicEnabled;
        if (!musicEnabled) {
          backgroundMusic.pause();
          backgroundMusic.currentTime = 0;
          toggleMusicBtn.textContent = "üéµ Nyalakan Musik";
        } else {
          backgroundMusic.volume = 0.3;
          backgroundMusic.play().catch(() => {});
          toggleMusicBtn.textContent = "üéµ Matikan Musik";
        }
      };

      // Fungsi universal untuk mainkan efek suara
      function safePlay(audio) {
        if (soundEnabled && audio) {
          audio.currentTime = 0;
          audio.play().catch(() => {});
        }
      }

      // Fungsi untuk mengubah angka menjadi superscript
      function toSuperscript(text) {
        const superscriptMap = {
          0: "‚Å∞",
          1: "¬π",
          2: "¬≤",
          3: "¬≥",
          4: "‚Å¥",
          5: "‚Åµ",
          6: "‚Å∂",
          7: "‚Å∑",
          8: "‚Å∏",
          9: "‚Åπ",
        };

        return text.replace(/\d+/g, (match) => {
          return match
            .split("")
            .map((digit) => superscriptMap[digit] || digit)
            .join("");
        });
      }

      // Fungsi untuk memformat input pengguna menjadi format spdf dengan superscript
      function formatElectronConfig(input) {
        // Hapus spasi berlebih
        let formatted = input.trim().toUpperCase();

        // Format: 1s2 -> 1s¬≤
        formatted = formatted.replace(
          /(\d+)([SPDF])(\d+)/gi,
          (match, n, orbital, electrons) => {
            return n + orbital.toLowerCase() + toSuperscript(electrons);
          }
        );

        // Format untuk 1s¬≤  1s¬≤ 2s¬≤ 2p‚Å∂, 1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂, dll tetap huruf besar
        formatted = formatted.replace(/\[([A-Z]+)\]/g, (match) =>
          match.toUpperCase()
        );

        return formatted;
      }

      // Fungsi untuk normalisasi perbandingan (hapus superscript untuk perbandingan)
      function normalizeConfig(text) {
        const superToNormal = {
          "‚Å∞": "0",
          "¬π": "1",
          "¬≤": "2",
          "¬≥": "3",
          "‚Å¥": "4",
          "‚Åµ": "5",
          "‚Å∂": "6",
          "‚Å∑": "7",
          "‚Å∏": "8",
          "‚Åπ": "9",
        };

        let normalized = text.toUpperCase();
        Object.keys(superToNormal).forEach((sup) => {
          normalized = normalized.replace(
            new RegExp(sup, "g"),
            superToNormal[sup]
          );
        });

        // Pertahankan spasi untuk validasi yang lebih ketat
        return normalized;
      }

      elements.forEach((el) => {
        const color = getColor(el.z);
        const card = document.createElement("div");
        card.className = "element";
        // attach atomic number and correct spdf for later lookups
        card.dataset.z = String(el.z);
        card.dataset.spdf = el.spdf;
        card.style.gridRow = el.r;
        card.style.gridColumn = el.c;
        card.innerHTML = `
                                    <div class="inner">
                                      <div class="face front">
                                        <div class="atomic-number">${el.z}</div>
                                        <div class="symbol">${el.s}</div>
                                        <div class="mass">${el.mass}</div>
                                      </div>
                                      <div class="face back" style="background:${color}">
                                        <div style="font-size:calc(var(--card-h)*0.12); line-height:1.4; word-spacing:0.1em;">
                                          ${el.spdf}
                                        </div>
                                      </div>
                                    </div>
                                    <div class="input-wrap">
                                  <input type="text" placeholder="Tulis konfigurasi elektron" />
                                  <button class="submitBtn">‚úî</button>
                                </div>
                                  `;

        const input = card.querySelector("input");
        const submitBtn = card.querySelector(".submitBtn");
  // ensure we can call the check from outside (modal confirm)
        function checkAnswer() {
          // Format input pengguna dengan superscript
          const userInput = formatElectronConfig(input.value.trim());

          // Normalisasi keduanya untuk perbandingan
          const normalizedUser = normalizeConfig(userInput);
          const normalizedCorrect = normalizeConfig(el.spdf);

          if (normalizedUser === normalizedCorrect) {
            // Jawaban benar
            card.classList.add("flipped");
            card.dataset.answered = "1"; // mark as answered so it persists / cannot be toggled locally
            if (soundEnabled) {
              clickSound.currentTime = 0;
              clickSound.play();
            }
            input.value = userInput;
            input.disabled = true;
            submitBtn.disabled = true;
            input.style.borderColor = "green";
            input.style.backgroundColor = "rgba(0, 255, 0, 0.1)";

            // ‚úÖ Tambahkan skor dan simpan ke Firebase (aman jika simpanSkor belum terpasang)
            window.userScore = (window.userScore || 0) + 1;
            const score = window.userScore;
            const userScoreEl = document.getElementById("userScore");
            if (userScoreEl) userScoreEl.textContent = `Skor: ${score}`;
            const answeredEl = document.getElementById("answeredCorrect");
            if (answeredEl) answeredEl.textContent = score;

            // record the raw user input into per-card history (for modal)
            try { pushHistory(input.value); } catch(e){}

            // Save answered element + score to DB via markAnswered (preferred) or fallback to simpanSkor
            if (typeof window.markAnswered === "function") {
              try {
                window.markAnswered(el.z, score);
              } catch (e) {
                console.warn("markAnswered error:", e);
              }
            } else if (typeof window.simpanSkor === "function") {
              try {
                window.simpanSkor(score);
              } catch (e) {
                console.warn("simpanSkor error:", e);
              }
            } else {
              // retry briefly in case module not ready
              setTimeout(() => {
                if (typeof window.markAnswered === "function") window.markAnswered(el.z, score);
                else if (typeof window.simpanSkor === "function") window.simpanSkor(score);
              }, 800);
            }
          } else {
            // Jawaban salah
            input.style.borderColor = "red";
            input.style.backgroundColor = "rgba(255, 0, 0, 0.1)";
            if (soundEnabled) {
              wrongSound.currentTime = 0;
              wrongSound.play();
            }
            input.style.animation = "shake 0.5s";
            setTimeout(() => (input.style.animation = ""), 500);
          }

          // Shake animation
          input.style.animation = "shake 0.5s";
          setTimeout(() => {
            input.style.animation = "";
          }, 500);
        }
        // open modal when user focuses the input or clicks submit so they can see a larger input and history
        input.addEventListener("focus", (e) => {
          openAnswerModal(card);
        });

        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            openAnswerModal(card);
          }
        });

        submitBtn.addEventListener("click", (e) => {
          e.preventDefault();
          openAnswerModal(card);
        });

  const inner = card.querySelector(".inner");

  // attach checkAnswer to card element so modal can call it
  card.checkAnswer = checkAnswer;

        input.addEventListener("keyup", (e) => {
          if (e.key === "Enter") {
            const answer = input.value.trim().toUpperCase();
            if (answer === el.spdf.toUpperCase()) {
              card.classList.add("flipped");
              if (soundEnabled) {
                clickSound.currentTime = 0;
                clickSound.play();
              }
              input.disabled = true; // kunci input setelah benar
            } else {
              input.style.borderColor = "red"; // feedback salah
            }
          }
        });

        // Klik pada inner tidak akan membalik kartu - harus melalui jawaban benar
        inner.addEventListener("click", () => {
          if (card.dataset.answered === "1") return; // block toggling for persisted answers
          // Kartu tidak dibalik dengan klik manual
          return;
        });

        // store per-card input history in dataset.history as JSON string
        function pushHistory(raw) {
          try {
            let arr = [];
            if (card.dataset.history) arr = JSON.parse(card.dataset.history);
            arr.push(String(raw || "").trim());
            // keep last 30 entries
            if (arr.length > 30) arr = arr.slice(arr.length - 30);
            card.dataset.history = JSON.stringify(arr);
          } catch (e) {
            card.dataset.history = JSON.stringify([String(raw || "").trim()]);
          }
        }

        // Update answer history UI if modal open for this card
        function updateModalHistoryUI() {
          const modal = document.getElementById('answerInputModal');
          if (!modal || modal.style.display === 'none') return;
          const histEl = document.getElementById('answerHistory');
          const zInModal = modal.dataset.z;
          if (!histEl) return;
          let arr = [];
          try { arr = card.dataset.history ? JSON.parse(card.dataset.history) : []; } catch(e){ arr = []; }
          histEl.innerHTML = '';
          if (arr.length === 0) {
            histEl.innerHTML = '<div style="color:#666">Belum ada input untuk unsur ini.</div>';
            return;
          }
          arr.slice().reverse().forEach((v) => {
            const d = document.createElement('div');
            d.style.padding = '6px 8px';
            d.style.borderBottom = '1px solid #f0f0f0';
            d.style.fontSize = '13px';
            d.textContent = v || '(kosong)';
            histEl.appendChild(d);
          });
        }

        grid.appendChild(card);
      });
      // ---- Modal wiring: open/close/submit handlers ----
      (function wireAnswerModal(){
        const modal = document.getElementById('answerInputModal');
        const modalInput = document.getElementById('answerModalInput');
        const histEl = document.getElementById('answerHistory');
        const btnCancel = document.getElementById('answerModalCancel');
        const btnSubmit = document.getElementById('answerModalSubmit');
        if (!modal || !modalInput || !btnCancel || !btnSubmit) return;

        function openAnswerModal(card) {
          if (!card) return;
          modal.dataset.z = card.dataset.z || '';
          // set textarea to current input value
          const input = card.querySelector('input');
          modalInput.value = input ? input.value : '';
          modal.style.display = 'flex';
          setTimeout(()=> modalInput.focus(), 50);
          // populate history
          try {
            const arr = card.dataset.history ? JSON.parse(card.dataset.history) : [];
            histEl.innerHTML = '';
            if (arr.length === 0) histEl.innerHTML = '<div style="color:#666">Belum ada input untuk unsur ini.</div>';
            arr.slice().reverse().forEach((v) => {
              const d = document.createElement('div');
              d.style.padding = '6px 8px';
              d.style.borderBottom = '1px solid #f0f0f0';
              d.style.fontSize = '13px';
              d.textContent = v || '(kosong)';
              histEl.appendChild(d);
            });
          } catch(e){ histEl.innerHTML = '<div style="color:#666">Belum ada input untuk unsur ini.</div>'; }
        }

        window.openAnswerModal = openAnswerModal;

        btnCancel.onclick = () => {
          modal.style.display = 'none';
        };

        btnSubmit.onclick = () => {
          const z = modal.dataset.z;
          if (!z) return;
          const card = document.querySelector(`.element[data-z="${z}"]`);
          if (!card) return;
          // write value back to card input and call its checkAnswer
          const input = card.querySelector('input');
          if (input) input.value = modalInput.value.trim();
          // push into history on the card
          try {
            let arr = card.dataset.history ? JSON.parse(card.dataset.history) : [];
            arr.push(String(modalInput.value || '').trim());
            if (arr.length > 30) arr = arr.slice(arr.length - 30);
            card.dataset.history = JSON.stringify(arr);
          } catch(e){ card.dataset.history = JSON.stringify([String(modalInput.value || '').trim()]); }

          modal.style.display = 'none';
          // call the card's checkAnswer if present; else try to click its submit button
          try {
            if (typeof card.checkAnswer === 'function') card.checkAnswer();
            else {
              const sb = card.querySelector('.submitBtn');
              if (sb) sb.click();
            }
          } catch(e){ console.error('modal submit check error', e); }
        };

        // allow Enter to submit inside textarea with Ctrl+Enter to insert newline
        modalInput.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter' && !ev.ctrlKey) {
            ev.preventDefault();
            btnSubmit.click();
          }
          if (ev.key === 'Escape') {
            modal.style.display = 'none';
          }
        });
      })();
    </script>

      <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import {
          getAuth,
          onAuthStateChanged,
          signOut,
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import {
          getDatabase,
          ref,
          set,
          get,
          onValue,
          remove,
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // üî• Konfigurasi Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyC_9KDssyYNV6vBh3yKLnyFwZVsk47uq7I",
          authDomain: "login-731fd.firebaseapp.com",
          databaseURL: "https://login-731fd-default-rtdb.firebaseio.com/",
          projectId: "login-731fd",
          storageBucket: "login-731fd.appspot.com",
          messagingSenderId: "1000932743704",
          appId: "1:1000932743704:web:c2e2fc36435ed2fd48416d",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let currentUser = null;
        let userScore = 0; // skor global

        // üîπ Deteksi login
        onAuthStateChanged(auth, (user) => {
          if (user) {
            currentUser = user;
            console.log("‚úÖ User login:", user.displayName, user.email);
            document.getElementById("userDisplay").textContent = `üëã Hai, ${
              user.displayName || "Tanpa Nama"
            }!`;
            // Cek profil user (users/{uid}) ‚Äî jika belum ada 'kelas', minta input user
            const userRef = ref(db, `users/${user.uid}`);
            get(userRef)
              .then((snapUser) => {
                const profile = snapUser.exists() ? snapUser.val() : {};
                const kelas = profile.kelas;

                if (!kelas) {
                  // tampilkan modal pilih kelas
                  const modal = document.getElementById("chooseClassModal");
                  if (modal) modal.style.display = "flex";

                  const saveBtn = document.getElementById("saveKelasBtn");
                  const skipBtn = document.getElementById("skipKelasBtn");
                  const select = document.getElementById("kelasSelect");

                  function cleanup() {
                    if (saveBtn) saveBtn.onclick = null;
                    if (skipBtn) skipBtn.onclick = null;
                  }

                  if (saveBtn) {
                    saveBtn.onclick = () => {
                      const pilihan = (select && select.value) || "";
                      if (!pilihan) {
                        alert("Pilih kelas terlebih dahulu atau tekan Lewati.");
                        return;
                      }

                      // simpan kelas ke users/{uid}/kelas
                      set(ref(db, `users/${user.uid}/kelas`), pilihan)
                        .then(() => {
                          // simpan nama juga jika belum ada
                          if (!profile.nama && user.displayName) {
                            set(ref(db, `users/${user.uid}/nama`), user.displayName).catch(() => {});
                          }
                          const modal = document.getElementById("chooseClassModal");
                          if (modal) modal.style.display = "none";
                          cleanup();
                          // perbarui leaderboard entry sekarang (jika ada skor tersimpan)
                          if (typeof window.simpanSkor === "function") {
                            const currentScore = window.userScore || 0;
                            window.simpanSkor(currentScore);
                          }
                        })
                        .catch((err) => {
                          console.error("Gagal menyimpan kelas:", err);
                          alert("Gagal menyimpan kelas. Coba lagi.");
                        });
                    };
                  }

                  if (skipBtn) {
                    skipBtn.onclick = () => {
                      const modal = document.getElementById("chooseClassModal");
                      if (modal) modal.style.display = "none";
                      cleanup();
                    };
                  }
                }

                // Ambil skor yang tersimpan di leaderboard (jika ada) dan tampilkan.
                // Jika user sudah mengumpulkan poin di session sebelum modul Firebase siap,
                // gabungkan: pakai nilai tertinggi antara session (window.userScore) dan saved score.
                const leaderboardRef = ref(db, `leaderboard/${user.uid}`);
                return get(leaderboardRef).then((lbSnap) => {
                  return { lbSnap, profile };
                });
              })
              .then(({ lbSnap, profile }) => {
                const saved = lbSnap && lbSnap.exists() ? Number(lbSnap.val().skor || 0) : 0;
                const session = Number(window.userScore || 0);
                // get answered list and use length to help determine merged score
                return get(ref(db, `users/${user.uid}/answered`)).then((ansSnap) => {
                  let answeredArr = [];
                  if (ansSnap && ansSnap.exists()) {
                    const val = ansSnap.val();
                    if (Array.isArray(val)) answeredArr = val.map(Number);
                    else if (typeof val === 'object') answeredArr = Object.values(val).map(Number);
                  }
                  const answeredLen = answeredArr.length || 0;
                  const merged = Math.max(saved, session, answeredLen);
                  userScore = merged;
                  window.userScore = merged;

                  const userScoreEl = document.getElementById("userScore");
                  if (userScoreEl) userScoreEl.textContent = `Skor: ${merged}`;
                  const answeredEl = document.getElementById("answeredCorrect");
                  if (answeredEl) answeredEl.textContent = merged;

                  // Jika session memiliki skor lebih tinggi daripada yang tersimpan, update DB
                  if (session > saved && typeof window.simpanSkor === "function") {
                    try {
                      window.simpanSkor(session);
                    } catch (e) {
                      console.warn("simpanSkor saat merge error:", e);
                    }
                  }

                  // Flip answered cards in DOM
                  if (answeredArr.length > 0 && typeof window.flipAnswered === 'function') {
                    try {
                      window.flipAnswered(answeredArr);
                    } catch (e) {
                      console.warn('flipAnswered error', e);
                    }
                  }
                });
              })
              .catch(() => {});
          } else {
            alert("Silakan login terlebih dahulu.");
            window.location.href = "index.html";
          }
        });

        // üîπ Simpan skor berdasarkan user login
      function simpanSkor(skor) {
  if (!currentUser) {
    console.warn("User belum login, skor tidak tersimpan.");
    return;
  }

  const uid = currentUser.uid;
  const userRef = ref(db, `users/${uid}`);

  // üîπ Ambil data kelas dari node users
  get(userRef)
    .then((snapshot) => {
      let kelas = "Tidak Diketahui";
      let nama = currentUser.displayName || "Pengguna";

      if (snapshot.exists()) {
        const userData = snapshot.val();
        kelas = userData.kelas || kelas;
        nama = userData.nama || nama;
      }

      // üîπ Simpan ke leaderboard (hanya jika skor baru lebih tinggi atau sama)
      const leaderboardRef = ref(db, `leaderboard/${uid}`);
      return get(leaderboardRef).then((lbSnap) => {
        const existing = lbSnap && lbSnap.exists() ? Number(lbSnap.val().skor || 0) : 0;
        if (skor >= existing) {
          return set(leaderboardRef, {
            nama: nama,
            email: currentUser.email,
            kelas: kelas,
            skor: skor,
            waktu: new Date().toISOString(),
          });
        }
        // jika skor yang tersimpan lebih tinggi, jangan turunkan; resolve tanpa menulis
        return Promise.resolve();
      });
    })
    .then(() => {
      console.log("‚úÖ Skor tersimpan di leaderboard");
    })
    .catch((err) => {
      console.error("‚ùå Gagal menyimpan skor:", err);
    });
}
        // ‚öôÔ∏è Tandai sebuah unsur sebagai dijawab (simpan daftar 'answered' pengguna)
        function markAnswered(z, skor) {
          if (!currentUser) {
            console.warn('User belum login, tidak dapat menyimpan answered.');
            return Promise.resolve();
          }
          const uid = currentUser.uid;
          const answeredRef = ref(db, `users/${uid}/answered`);

          return get(answeredRef)
            .then((snap) => {
              let arr = [];
              if (snap && snap.exists()) {
                const v = snap.val();
                if (Array.isArray(v)) arr = v.map(Number);
                else if (typeof v === 'object') arr = Object.values(v).map(Number);
              }
              const num = Number(z);
              if (!arr.includes(num)) arr.push(num);
              arr = Array.from(new Set(arr)).sort((a, b) => a - b);
              return set(answeredRef, arr).then(() => {
                // simpan juga skor per-user di node users (opsional)
                try { set(ref(db, `users/${uid}/skor`), skor); } catch (e) {}
                // update leaderboard (simpanSkor sudah akan menulis bila >= existing)
                if (typeof simpanSkor === 'function') simpanSkor(skor);
              });
            })
            .catch((err) => {
              console.error('Gagal update answered:', err);
            });
        }

        // ÔøΩ Flip DOM cards berdasarkan daftar answered yang tersimpan
        function flipAnswered(arr) {
          if (!arr) return;
          const list = Array.isArray(arr) ? arr.map(Number) : Object.values(arr).map(Number);
          list.forEach((z) => {
            try {
              const card = document.querySelector(`.element[data-z="${z}"]`);
              if (!card) return;
              card.classList.add('flipped');
              card.dataset.answered = '1';
              const input = card.querySelector('input');
              const submitBtn = card.querySelector('.submitBtn');
              if (input) {
                input.value = formatElectronConfig(card.dataset.spdf || '');
                input.disabled = true;
              }
              if (submitBtn) submitBtn.disabled = true;
            } catch (e) {
              console.warn('flipAnswered item error', e);
            }
          });
        }

        // ‚ôªÔ∏è Reset skor dan kartu user (user-triggered)
        function showToast(msg, timeout = 3000) {
          const t = document.getElementById('toast');
          if (!t) return;
          t.textContent = msg;
          t.style.display = 'block';
          t.style.opacity = '1';
          if (t._timeout) clearTimeout(t._timeout);
          t._timeout = setTimeout(() => {
            t.style.opacity = '0';
            setTimeout(() => (t.style.display = 'none'), 300);
          }, timeout);
        }

        function resetProgress() {
          // show confirmation modal instead of alert/confirm
          if (!currentUser) {
            showToast('Silakan login untuk mereset progres.');
            return;
          }
          const modal = document.getElementById('resetConfirmModal');
          const cancelBtn = document.getElementById('cancelResetBtn');
          const confirmBtn = document.getElementById('confirmResetBtn');
          if (!modal || !cancelBtn || !confirmBtn) {
            // fallback to old confirm if modal missing
            const ok = confirm('Yakin ingin mereset skor dan mengembalikan kartu? Tindakan ini akan menghapus progres Anda.');
            if (!ok) return;
            return actualResetProgress();
          }

          modal.style.display = 'flex';

          function cleanup() {
            cancelBtn.onclick = null;
            confirmBtn.onclick = null;
          }

          cancelBtn.onclick = () => {
            modal.style.display = 'none';
            cleanup();
          };

          confirmBtn.onclick = () => {
            modal.style.display = 'none';
            cleanup();
            actualResetProgress();
          };
        }

        function actualResetProgress() {
          const uid = currentUser.uid;
          const userRef = ref(db, `users/${uid}`);
          // Ambil profil untuk menulis ulang leaderboard minimal
          get(userRef)
            .then((snap) => {
              const profile = snap && snap.exists() ? snap.val() : {};
              const nama = profile.nama || currentUser.displayName || 'Pengguna';
              const kelas = profile.kelas || '-';

              // set answered ke array kosong dan users/{uid}/skor ke 0
              const p1 = set(ref(db, `users/${uid}/answered`), []);
              const p2 = set(ref(db, `users/${uid}/skor`), 0);
              // dan set leaderboard skor ke 0 (karena user sendiri meminta reset)
              const p3 = set(ref(db, `leaderboard/${uid}`), {
                nama: nama,
                email: currentUser.email,
                kelas: kelas,
                skor: 0,
                waktu: new Date().toISOString(),
              });

              return Promise.all([p1, p2, p3]);
            })
            .then(() => {
              // update UI: unflip all cards and reset counters
              document.querySelectorAll('.element').forEach((card) => {
                card.classList.remove('flipped');
                delete card.dataset.answered;
                const input = card.querySelector('input');
                const submitBtn = card.querySelector('.submitBtn');
                if (input) {
                  input.value = '';
                  input.disabled = false;
                  input.style.borderColor = '';
                  input.style.backgroundColor = '';
                }
                if (submitBtn) submitBtn.disabled = false;
              });
              window.userScore = 0;
              const userScoreEl = document.getElementById('userScore');
              if (userScoreEl) userScoreEl.textContent = 'Skor: 0';
              const answeredEl = document.getElementById('answeredCorrect');
              if (answeredEl) answeredEl.textContent = '0';
              showToast('Progres berhasil di-reset.');
            })
            .catch((err) => {
              console.error('Gagal mereset progres:', err);
              showToast('Gagal mereset progres. Coba lagi.');
            });
        }
        // ÔøΩüîπ Tampilkan leaderboard
  // üîπ Tampilkan leaderboard (global atau per kelas)
  function showLeaderboard(mode = "global") {
    const leaderboardRef = ref(db, "leaderboard");
    onValue(leaderboardRef, (snapshot) => {
      const data = snapshot.val();
      const leaderboardBody = document.getElementById("leaderboardBody");
      leaderboardBody.innerHTML = "";

      if (data) {
        let daftar = Object.values(data);

        // üî∏ Filter leaderboard berdasarkan kelas user
        if (mode === "kelas" && currentUser) {
          const userData = Object.values(data).find(
            (u) => u.email === currentUser.email
          );
          const userKelas = userData?.kelas;
          daftar = daftar.filter((u) => u.kelas === userKelas);
        }

        // üî∏ Urutkan berdasarkan skor tertinggi
        daftar.sort((a, b) => b.skor - a.skor);

        // üî∏ Tampilkan data
        daftar.forEach((p, i) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td style="padding:6px;">${i + 1}</td>
            <td style="padding:6px;">${p.nama}</td>
            <td style="padding:6px;">${p.kelas || "-"}</td>
            <td style="padding:6px;">${p.skor}</td>
          `;
          leaderboardBody.appendChild(tr);
        });
      } else {
        leaderboardBody.innerHTML =
          `<tr><td colspan="4" style="padding:10px;">Belum ada data</td></tr>`;
      }
    });

    // Tampilkan modal
    document.getElementById("leaderboardModal").style.display = "flex";
  }
  // üîπ Tutup leaderboard modal
function closeLeaderboard() {
  document.getElementById("leaderboardModal").style.display = "none";
}
        // üîπ Logout (opsional)
        function logout() {
          signOut(auth).then(() => {
            alert("Anda telah logout.");
            window.location.href = "index.html";
          });
        }

        // ‚è¨ Simpan fungsi ke global agar bisa dipanggil dari script utama
        window.simpanSkor = simpanSkor;
  window.markAnswered = markAnswered;
  window.flipAnswered = flipAnswered;
  window.resetProgress = resetProgress;
        window.showLeaderboard = showLeaderboard;
        window.closeLeaderboard = closeLeaderboard;
        window.logout = logout;
        window.userScore = userScore;
      </script>
    </body>
  </html>



